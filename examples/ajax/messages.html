<!DOCTYPE html>

<html>
<head>
	<title>Messages</title>
	<script>
		request = new XMLHttpRequest();

		// Step 1: Make request
		request.open("GET", "https://messagehub.herokuapp.com/messages.json", true);

		// No, the following will NOT WORK!  *Can you explain why?*
		//request.open("GET", "http://developer.mbta.com/lib/rthr/red.json", true);
		
		// Step 2: Handle the response. callme is a function defined below.
		request.onreadystatechange = callme;

		// Step 3: Fire off the request
		request.send(null); // null means no data nec to send

		function callme () {
			// Step 3: Data is ready --there is a response!
			// A common mistake people make: only check if readyState == 4. Why is that very bad?
			if (request.readyState == 4 && request.status == 200) {
				result = "";
				raw = request.responseText;
				messages = JSON.parse(raw);
				elem = document.getElementById("list");
				for (i = 0; i < messages.length; i++) {
					result += "<p>" + messages[i]["username"] + " said " + messages[i]["content"] + "</p>";
				}
				elem.innerHTML = result;
			}
			else if (request.readyState == 4 && request.status != 200) {
				document.getElementById("list").innerHTML = "<p>Whoops, #fail</p>";
			}
		};
	</script>
</head>

<body>
	<h1>Messages</h1>
	<div id="list">Nothing to show...</div>
</body>
</html>
